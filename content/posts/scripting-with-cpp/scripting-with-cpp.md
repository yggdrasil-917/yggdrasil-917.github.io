---
title: "Scripting With Cpp"
date: 2024-07-03T11:57:54-07:00
draft: false
toc: false
images:
tags: 
  - engine
  - scripting
---

Early on in Tempest's development it was decided not to adopt a scripting language and instead use c++, the same language used to make the engine. This more or less goes against the norm these days seeing as how most engines have a scripting language. In fact, you can probably count the number of professional engines that only offer c++ for scripting in one hand. Unreal Engine being by far the most popular one in that category. There are some smaller engines like [Flax](https://flaxengine.com/) that offers c++ or c# for scripting otherwise, you're likely using something other than c++ for your scripting needs.

I've been asked several times in the past what scripting language I decided to adopt for Tempest and people are usually surprised at the fact that I stuck with c++. So I'll use this post to go over the reasons why, however, I can't stress enough that all decisions have pros and cons. This is no different. That said I can live with the cons for the kinds of games I'm trying to make with Tempest.

## Deciding On Cpp
So how did I go about deciding on c++? There's actually a lot of things I did before making my decision and I'll cover some of them here. The very first thing I did was to take a look at the current state of the game scripting language landscape. The engine I made before Tempest was a long time ago and for that I had decided to use Lua as the scripting language. One of the main reasons was to get first hand knowledge on setting up a scripting language in a custom engine and at the time Lua seemed pretty popular for this. Fast forward to present time and the scripting language ecosystem hasn't really changed all that much since the last time I looked into this. The popular scripting languages still seemed to be the same as they were back then. Mostly c#, lua, and python. I'm ignoring languages like GDScript as that is tied to Godot but I do recognize that one has gained a lot of popularity as Godot has gotten more popular. That said I've added below a few thoughts I had when evaluating each of those languages.
* **c#** - Unity made this super popular for game scripting and there is a large community out there with loads of third party libraries for anything you may need. Unity however, has done many custom things to make c# useful for game development. Things that would not be available to my custom engine and thus makes it a tougher sell to adopt c#. I was close to deciding to bite the bullet and add support for it in Tempest but looking at Mono quickly removed any desire to use it so I didn't.
* **lua** - Another very popular option touted to be lightweight and easy to integrate. I can definitely vouch for it being easy to integrate into a custom c++ engine. It is dynamically typed though and that is something I'm not really willing to deal with unless work makes me. Dynamic typing makes it so easy to hide bugs that I just prefer not rely too much on systems like that. The community has gotten bigger but it still seems to lag behind the other two languages I'm mentioning here. This also means there are less libraries to be found than in c# or python so it's possible you may have to do more things yourself.
* **python** - Similar enough to lua but again dynamically typed so I want to stay away from it. Has a lot of libraries and large community. Performance though is a serious issue as it is very easy to write code that looks performant but due to how the language works it ends up being a hard to detect performance bottleneck. Some of that will be mitigated with experience using the language but it is still a tough sell.

Another thing I don't see mentioned often with regards to scripting languages is debugging your scripts in your favorite IDE. In many cases, you may need to write a custom plugin to enable breakpoints inside your chosen scripting language and that's if it is even possible to do that. I know it is fairly new but Unreal Verse does not support breakpoints right now and instead expects developers to use print statements for their debugging. For some of the bigger game engine developers, it's common for them to provide their own IDE plugins to enable things like breakpoints for example. This is sort of a hidden cost to adopting a scripting language whereas, sticking with c++ you already have all of that in working condition. 

Memory management is another key thing to consider. A lot of scripting languages may have garbage collection or rely on ARC whereas, c/c++ works very differently by default but can be extended to have things like GC (see Unreal Engine). In the case of c#, you have to think about managed memory and if you have to cross the boundary between managed and unmanaged then things can start getting a bit annoying to deal with the requirements that can have. Not to mention crossing language boundaries can be annoying as well. I'm picking a little on c# here but crossing language boundaries can be defficult in other scripting languages.

Developing and maintaining a powerful scripting API for your game dev needs is a ton of work. It's not uncommon to duplicate work already done in native. For instance, a math library built to meet your game development needs is likely going to be required in your scripting API but you likely already have that built in your native language or are using a third party library for that. All of a sudden you need support for vectors, matrices, RNG, and the list goes on and on. You might think that it's a good idea to just build a wrapper API in your scripting language that simply calls native functions all the time but you will learn it isn't a good idea as crossing language barriers has non-negligible cost that quickly adds up to become a performance issue. This then brings up the age old question of what exactly should be exposed at an API level to the scripting language. It's not always clear how to handle this and is something that should be asked anytime more things are added to your scripting layer. This becomes a bigger problem as a solo developer since extending the scripting layer also means a larger codebase to maintain. This is also a problem that much larger engines run into as well. I've run into so many situations using Unreal where certain functions don't exists in blueprint but are there in c++ or a variant of a function I need is in blueprint but not the correct variant. If you're working from source then it is likely easy to add support for it but otherwise you're stuck with that limitation and creates tons of frustrations.

Now lets talk about performance for a bit. This is one major sticking point with scripting languages in general. The argument being that scripting languages exist for their ease of use and not for their performance. On the one hand, I'm glad the simplicity of these scripting languages has made it possible for more people to contribute to gameplay, editor tools, etc. On the other hand, I've had one too many situations throughout my career where I had to convert scripts into c++ in order to improve performance and be able to ship features. While this isn't the norm, it does happen often enough that sometimes it makes me question the usefulness of scripting languages. This also applies to node based scripting tools like blueprint. The nodes can often be a little too high level to the point where developers don't even think about what a node may actually be doing behind the scenes and just assume it is a fast operation. Oh and if the node graph is complex enough that the original author can't even debug it when problems occur then you can bet that's going to be redone in c++.

One huge thing I do miss about using c++ for scripting has to do with hot reloading. C++ has always been difficult on that front. Tons of solutions developed over the years but none of them seem to be very reliable or even working these days. Even the live coding feature in Unreal is very finicky. There are many situations where hot reloading can't work in the language. For most part you're only able to change data values and only in your cpp files as header changes are out of the question. This is something scripting languages usually excel at. I say usually since for several years now hot reloading c# code in Unity has been inconsistent to say the least. The main issue they've had for a while now is that reloading their c# domain can take a very long time and sometimes after it has finished you may run into issues with your scripts. Point being that just adopting a scripting language doesn't automatically make hot reloading easy or useful. I'm secretly hoping that c++ modules might be able to make things better but so far I haven't seen much work done on that front so it remains to be seen if this might be the way forward for hot reloading c++ code. It's also worth mentioning that VS 2022 brought a hot reloading feature to c++ and I was delighted that it worked once upon a time but as my project has gotten much bigger that feature stopped working.

I haven't talked about compilation yet. C++ is obviously a compiled language and as such will also generate machine code that in theory is also optimal for the platform it is running on. This does mean that it needs to be compiled and linked before it can be used whereas some scripting languages are interpreted so no compilation or linking is needed. This  means faster iteration times which in game development is very important. C++ can be slow to compile if you're careless with how you structure the codebase. This is something you need to be on top of throughout development so you don't fall into the trap of including all sorts of headers everywhere in your codebase and then realize your compile times are horrible because of that. This is pretty much what happend to Unreal Engine 4 early on before somebody had the unfortunate task of cleaning up header includes througout the engine and coming up with better coding practices to minimize that issue moving forward.

I've rambled on a bit too long and I haven't mentioned all the things I considered but hopefully this gets the point across as to how I went about deciding on c++ for everything in my engine. This post will maybe come across as a bit harsh on scripting languages but I do see their benefit in the industry despite my opinions. However, I'm not trying to make a competitor to any of the popular game engines out there so I feel no need to emulate every single thing they do and instead I'd rather do my own thing. At the end of the day that's sort of the point of making a custom game engine isn't it? 